

Контроллер для симуляторов на базе  BMW F-Series шифтера и контроллера ESP32-S3 .

Код имеет  USBHID Shifterbox Gamedevice

-Нажимает кнопки 30 и 31 на 30мс если с шифтера поступает + gear - gear в режиме M/S
-Нажимает кнопки
N  - Кнопка 1
R  - Кнопка 2
D  - Кнопка 3


 Сборка и запуск

1.  Установите ESP-IDF 5.5.2 
4.  Подключите ESP32-S3 к шифтеру:
   - TX GPIO: 5
   - RX GPIO: 4
   - Скорость CAN: 500 kbps
5. Соберите проект
   Выбрать COM-Port 
   Прошить Flash Device
 



Использование

1. Подключите USB-OTG ESP32-S3 к компьютеру через USB
2. Подключить шифтер к CANtransiver А так же  CANlow CANHigh к шифтеру PT-CAN1 
3. Подать питание на шифтер +12V и WakeUP +12
4. Если комуникация межу шифтером и ESP32 корректная на шифтере загориться подсветка и отобразиться текущая передача.
5. Проверить что определился ли ESP32s3 как USBhid Gamedevice
6. Проверить работу кнопок и реацию на перемещения щифтера .
8. Можно назначать кнопки в любимый симулятор . 

CAN протокол

Прием от шифтера:
ID 0x197 (407) - Положение рычага (30мс)
  - Byte 2: позиция рычага (0x0E, 0x1E, 0x2E, 0x3E, 0x4E, 0x7E, 0x5E, 0x6E)
  - Byte 3: кнопка Park (0xC0 нормально, 0xD5 нажата)
- ID 0x55E - Heartbeat от шифтера (640мс)

Отправка шифтеру:
- ID 0x3FD (1021) - Отображение передачи (100мс)
  - Byte 3: индикация (0x20=P, 0x40=R, 0x60=N, 0x81=D/M)
  - Требует CRC в byte 1, счетчик в byte 2
- ID 0x202 (514) - Подсветка (1000мс)
  - Byte 1: уровень подсветки (0-254)
- ID 0x55E - Heartbeat ответ (640мс)




Проект создан для личного использования.

